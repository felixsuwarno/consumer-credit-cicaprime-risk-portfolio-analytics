WITH base_monthly_actual_cash AS
(
	SELECT
	DATE_TRUNC('month', payment_date)::date AS year_month,
	SUM(payment_amount) AS actual_cash
	FROM payments
	GROUP BY 1
),

monthly_actual_cash AS
(
	SELECT
		dm.month_start AS year_month,
	COALESCE(bmac.actual_cash, 0) AS actual_cash
	FROM dim_month dm
	LEFT JOIN base_monthly_actual_cash bmac
	ON dm.month_start = bmac.year_month
)

SELECT *
FROM monthly_actual_cash
ORDER BY year_month;